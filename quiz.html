<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Physics Cycle - MCQ Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .btn-secondary {
      background: #6b7280;
      box-shadow: none;
    }
    .btn-secondary:hover {
      background: #4b5563;
    }
    .quiz-option {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.6rem;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      font-size: 0.9rem;
      background: #f9fafb;
    }
    .quiz-option input {
      accent-color: #2563eb;
    }
    #quiz-feedback {
      margin-top: 0.6rem;
      font-size: 0.9rem;
      padding: 0.4rem 0.6rem;
      border-radius: 8px;
      display: none;
    }
    #quiz-feedback.correct {
      display: block;
      background: #dcfce7;
      color: #166534;
      border: 1px solid #16a34a;
    }
    #quiz-feedback.incorrect {
      display: block;
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid #ef4444;
    }
    #quiz-feedback.info {
      display: block;
      background: #e0f2fe;
      color: #0ea5e9;
      border: 1px solid #38bdf8;
    }
    #final-summary {
      margin-top: 0.6rem;
      font-size: 0.9rem;
      padding: 0.4rem 0.6rem;
      border-radius: 8px;
      background: #eef2ff;
      color: #4338ca;
      border: 1px solid #a5b4fc;
      display: none;
    }
    .coming-soon-text {
      font-size: 0.9rem;
      color: #6b7280;
      margin-top: 0.4rem;
    }
    .btn.coming-soon {
      background: #9ca3af;
      box-shadow: none;
      cursor: not-allowed;
    }
    .btn.coming-soon:hover {
      background: #9ca3af;
      transform: none;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="logo">Physics Cycle</div>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="branches.html" class="nav-link">Notes</a>
        <a href="quiz.html" class="nav-link active">Quiz</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="page-header">
      <div class="page-title-block">
        <h1 class="page-title">MCQ Quiz</h1>
        <p class="page-subtitle">
          Choose a subject and unit. Questions appear in random order, 10 at a time. For each question, click "Answer" to see if you're right. After 10 questions, you'll see your score and can continue until all questions are done.
        </p>
      </div>
    </section>

    <!-- 1. SUBJECT SELECTION -->
    <section>
      <h2 style="font-size:1rem;margin-bottom:0.5rem;">1. Choose a subject</h2>
      <div id="quiz-subject-buttons" class="subjects-buttons semester-buttons"></div>
    </section>

    <!-- 2. UNIT SELECTION -->
    <section style="margin-top:1.5rem;">
      <h2 style="font-size:1rem;margin-bottom:0.5rem;">2. Choose a unit</h2>
      <div id="quiz-unit-buttons" class="subjects-buttons">
        <p id="unit-placeholder" style="font-size:0.9rem;color:#6b7280;">
          Select a subject first.
        </p>
      </div>
      <p id="coming-soon-subject" class="coming-soon-text hidden"></p>
    </section>

    <!-- 3. QUESTION CARD -->
    <section id="quiz-card" class="card hidden" style="margin-top:1.5rem;">
      <div class="card-header-row">
        <h2 id="quiz-title" class="card-title"></h2>
        <span id="quiz-progress" class="branch-code"></span>
      </div>
      <p id="quiz-unit-label" class="card-desc"></p>

      <div id="question-block" style="margin-top:0.75rem;">
        <p id="question-text" style="font-weight:500;margin-bottom:0.5rem;"></p>
        <div id="options-container"
             style="display:flex;flex-direction:column;gap:0.4rem;"></div>
      </div>

      <div id="quiz-feedback"></div>
      <div id="final-summary"></div>

      <div style="display:flex;justify-content:flex-end;align-items:center;margin-top:1rem;gap:0.5rem;flex-wrap:wrap;">
        <button id="check-btn" class="btn" type="button">Answer</button>
        <button id="next-btn" class="btn btn-secondary" type="button" style="display:none;">
          Next Question
        </button>
        <button id="next-set-btn" class="btn btn-secondary" type="button" style="display:none;">
          Next 10 Questions
        </button>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 Physics Cycle â€¢ By Sujanraj. All rights reserved.</p>
  </footer>

  <!-- QUIZ DATA ROOT OBJECT -->
  <script>
    // Global data object; subject files (psp.js, physics.js, etc.)
    // will add their questions into this.
    const quizData = {};

    // Subjects to show on the UI:
    const allSubjects = [
      "PSP",
      "Physics",
      "Calculus",
      "Basic Electronics",
      "ADLD",
      "UHV",
      "COI"
    ];
  </script>

  <!-- SUBJECT DATA FILES -->
  <script src="psp.js"></script>
  <script src="physics.js"></script>
  <script src="calculus.js"></script>
  <script src="basicelectronics.js"></script>
  <script src="uhv.js"></script>
  <script src="coi.js"></script>
  <script src="adld.js"></script> <!-- ADLD data file -->

  <!-- QUIZ LOGIC -->
  <script>
    // =============== STATE ===============
    let currentSubject = null;
    let currentUnit = null;
    let currentQuestions = [];
    let questionOrder = [];
    let currentOrderIndex = 0;
    let questionsAnsweredOverall = 0;
    let questionsAnsweredInBatch = 0;
    let correctOverall = 0;
    let correctInBatch = 0;
    let batchNumber = 1;
    const BATCH_SIZE = 10;

    // =============== ELEMENTS ===============
    const subjectButtonsContainer = document.getElementById("quiz-subject-buttons");
    const unitButtonsContainer = document.getElementById("quiz-unit-buttons");
    const unitPlaceholder = document.getElementById("unit-placeholder");
    const comingSoonSubjectEl = document.getElementById("coming-soon-subject");

    const quizCard = document.getElementById("quiz-card");
    const quizTitle = document.getElementById("quiz-title");
    const quizUnitLabel = document.getElementById("quiz-unit-label");
    const quizProgress = document.getElementById("quiz-progress");

    const questionText = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");

    const checkBtn = document.getElementById("check-btn");
    const nextBtn = document.getElementById("next-btn");
    const nextSetBtn = document.getElementById("next-set-btn");

    const feedbackEl = document.getElementById("quiz-feedback");
    const finalSummaryEl = document.getElementById("final-summary");

    // =============== UTILS ===============
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // =============== RENDER SUBJECTS & UNITS ===============
    function renderSubjectButtons() {
      subjectButtonsContainer.innerHTML = "";
      comingSoonSubjectEl.classList.add("hidden");

      allSubjects.forEach((subject) => {
        const hasUnits =
          quizData[subject] && Object.keys(quizData[subject]).length > 0;

        const btn = document.createElement("button");
        btn.className = "btn subject-btn";
        if (!hasUnits) btn.classList.add("coming-soon");

        btn.dataset.subject = subject;
        btn.textContent = subject + (hasUnits ? "" : " (Coming soon)");

        btn.addEventListener("click", () => {
          currentSubject = subject;
          currentUnit = null;
          resetState();
          hideQuiz();

          subjectButtonsContainer
            .querySelectorAll(".subject-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          renderUnitButtons(hasUnits);
        });

        subjectButtonsContainer.appendChild(btn);
      });
    }

    function renderUnitButtons(hasUnitsForSubject) {
      unitButtonsContainer.innerHTML = "";
      if (unitPlaceholder) unitPlaceholder.remove();
      comingSoonSubjectEl.classList.add("hidden");

      if (!hasUnitsForSubject) {
        const p = document.createElement("p");
        p.style.fontSize = "0.9rem";
        p.style.color = "#6b7280";
        p.textContent = `Quizzes for ${currentSubject} are coming soon.`;
        unitButtonsContainer.appendChild(p);
        return;
      }

      const unitsObj = quizData[currentSubject] || {};
      const unitNames = Object.keys(unitsObj);

      if (unitNames.length === 0) {
        const p = document.createElement("p");
        p.style.fontSize = "0.9rem";
        p.style.color = "#6b7280";
        p.textContent = `Quizzes for ${currentSubject} are coming soon.`;
        unitButtonsContainer.appendChild(p);
        return;
      }

      unitNames.forEach((unitName) => {
        const questions = unitsObj[unitName] || [];
        const btn = document.createElement("button");
        btn.className = "btn chapter-btn";
        btn.textContent = questions.length
          ? unitName
          : `${unitName} (Coming soon)`;

        btn.addEventListener("click", () => {
          currentUnit = unitName;
          resetState();
          hideQuiz();

          unitButtonsContainer
            .querySelectorAll(".chapter-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          if (!questions.length) {
            finalSummaryEl.style.display = "block";
            finalSummaryEl.textContent = `Quiz for "${unitName}" is coming soon.`;
            return;
          }

          startUnitQuiz();
        });

        unitButtonsContainer.appendChild(btn);
      });
    }

    // =============== QUIZ FLOW ===============
    function resetState() {
      currentQuestions = [];
      questionOrder = [];
      currentOrderIndex = 0;
      questionsAnsweredOverall = 0;
      questionsAnsweredInBatch = 0;
      correctOverall = 0;
      correctInBatch = 0;
      batchNumber = 1;
      resetFeedback();
      finalSummaryEl.style.display = "none";
      finalSummaryEl.textContent = "";
      checkBtn.disabled = false;
      nextBtn.style.display = "none";
      nextSetBtn.style.display = "none";
    }

    function startUnitQuiz() {
      if (!currentSubject || !currentUnit) return;

      currentQuestions = quizData[currentSubject][currentUnit] || [];
      if (!currentQuestions.length) {
        finalSummaryEl.style.display = "block";
        finalSummaryEl.textContent = `Quiz for "${currentUnit}" is coming soon.`;
        return;
      }

      questionOrder = shuffle(
        Array.from({ length: currentQuestions.length }, (_, i) => i)
      );
      currentOrderIndex = 0;
      questionsAnsweredOverall = 0;
      questionsAnsweredInBatch = 0;
      correctOverall = 0;
      correctInBatch = 0;
      batchNumber = 1;

      quizCard.classList.remove("hidden");
      quizTitle.textContent = currentSubject;
      quizUnitLabel.textContent = currentUnit;
      finalSummaryEl.style.display = "none";
      nextSetBtn.style.display = "none";

      renderQuestion();
    }

    function renderQuestion() {
      resetFeedback();
      if (
        !currentQuestions.length ||
        currentOrderIndex < 0 ||
        currentOrderIndex >= currentQuestions.length
      ) {
        return;
      }

      const total = currentQuestions.length;
      const qIndex = questionOrder[currentOrderIndex];
      const q = currentQuestions[qIndex];

      quizProgress.textContent = `Q ${currentOrderIndex + 1} / ${total}`;
      questionText.textContent = q.text;

      optionsContainer.innerHTML = "";
      q.options.forEach((opt, index) => {
        const label = document.createElement("label");
        label.className = "quiz-option";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = "quiz-option";
        input.value = index;

        const span = document.createElement("span");
        span.textContent = opt;

        label.appendChild(input);
        label.appendChild(span);
        optionsContainer.appendChild(label);
      });

      checkBtn.disabled = false;
      nextBtn.style.display = "none";
      nextSetBtn.style.display = "none";
    }

    function getSelectedOptionIndex() {
      const inputs = optionsContainer.querySelectorAll('input[name="quiz-option"]');
      for (const input of inputs) {
        if (input.checked) return parseInt(input.value, 10);
      }
      return null;
    }

    function lockOptions() {
      const inputs = optionsContainer.querySelectorAll('input[name="quiz-option"]');
      inputs.forEach((input) => {
        input.disabled = true;
      });
    }

    function resetFeedback() {
      feedbackEl.className = "";
      feedbackEl.style.display = "none";
      feedbackEl.textContent = "";
    }

    function showInfo(msg) {
      feedbackEl.className = "info";
      feedbackEl.textContent = msg;
      feedbackEl.style.display = "block";
    }

    function showCorrect(msg) {
      feedbackEl.className = "correct";
      feedbackEl.textContent = msg;
      feedbackEl.style.display = "block";
    }

    function showIncorrect(msg) {
      feedbackEl.className = "incorrect";
      feedbackEl.textContent = msg;
      feedbackEl.style.display = "block";
    }

    function hideQuiz() {
      quizCard.classList.add("hidden");
      resetFeedback();
      finalSummaryEl.style.display = "none";
    }

    function showBatchSummary(isFinal) {
      const total = currentQuestions.length;
      finalSummaryEl.style.display = "block";

      if (isFinal) {
        finalSummaryEl.textContent =
          `Unit complete. Total score: ${correctOverall} / ${total}.`;
      } else {
        finalSummaryEl.textContent =
          `Batch ${batchNumber} complete. ` +
          `Score this batch: ${correctInBatch} / ${questionsAnsweredInBatch}. ` +
          `Total so far: ${correctOverall} / ${questionsAnsweredOverall}.`;
      }
    }

    // =============== EVENTS ===============
    checkBtn.addEventListener("click", () => {
      const selectedIndex = getSelectedOptionIndex();
      if (selectedIndex === null) {
        showInfo("Please select an option first.");
        return;
      }

      const qIndex = questionOrder[currentOrderIndex];
      const q = currentQuestions[qIndex];

      if (selectedIndex === q.correctIndex) {
        correctOverall++;
        correctInBatch++;
        showCorrect("Correct!");
      } else {
        showIncorrect("Wrong. Correct answer: " + q.options[q.correctIndex]);
      }

      questionsAnsweredOverall++;
      questionsAnsweredInBatch++;

      lockOptions();
      checkBtn.disabled = true;

      const isLastQuestionOverall =
        currentOrderIndex === currentQuestions.length - 1;
      const batchLimitReached = questionsAnsweredInBatch >= BATCH_SIZE;

      if (!isLastQuestionOverall && !batchLimitReached) {
        nextBtn.style.display = "inline-block";
        nextSetBtn.style.display = "none";
      } else {
        nextBtn.style.display = "none";
        const isFinal = isLastQuestionOverall;
        showBatchSummary(isFinal);

        if (!isFinal) {
          nextSetBtn.textContent = "Next 10 Questions";
          nextSetBtn.dataset.mode = "nextBatch";
          nextSetBtn.style.display = "inline-block";
        } else {
          nextSetBtn.textContent = "Finish";
          nextSetBtn.dataset.mode = "finish";
          nextSetBtn.style.display = "inline-block";
        }
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentOrderIndex < currentQuestions.length - 1) {
        currentOrderIndex++;
        renderQuestion();
      }
    });

    nextSetBtn.addEventListener("click", () => {
      const mode = nextSetBtn.dataset.mode;
      if (mode === "nextBatch") {
        questionsAnsweredInBatch = 0;
        correctInBatch = 0;
        batchNumber++;
        finalSummaryEl.style.display = "none";
        nextSetBtn.style.display = "none";

        if (currentOrderIndex < currentQuestions.length - 1) {
          currentOrderIndex++;
          renderQuestion();
        }
      } else if (mode === "finish") {
        quizCard.classList.add("hidden");
        nextSetBtn.style.display = "none";
      }
    });

    // =============== INIT ===============
    document.addEventListener("DOMContentLoaded", () => {
      renderSubjectButtons();
    });
  </script>
</body>
</html>
